<!DOCTYPE html>
<html>
<head>
<title>Who Said What, Where, When: Map and Timeline of Bible and
	Greek Philosophy</title>
<style>
#map {
	height: 400px;
	width: 100%;
}
</style>
</head>
<body>
	<h1>Who Said What, Where, When: Map and Timeline of Bible and
		Greek Philosophy</h1>
	<div id="map"></div>
	<script type="text/javascript" src="grbibdata.js">
		
	</script>
	<script>
		// If two entries are in the same location, offset one from the other by a small random distance
		var posDB = [];
		function resolvePos(pos) {
			for (var i = 0; i < posDB.length; i++) {
				if (pos.lat == posDB[i].lat && pos.lng == posDB[i].lng) {
					var latDiff = Math.random() / 100;
					var lngDiff = Math.random() / 100;
					console.log("Change pos " + JSON.stringify(pos));
					pos = {
						lat : pos.lat + latDiff,
						lng : pos.lng + lngDiff
					};
					console.log("   to " + JSON.stringify(pos));
					break;
				}
			}
			posDB.push(pos);
			return pos;
		}

		function initMap() {
			prepAncientEntities();
			var centerPos = resolvePos(centerLocation);
			
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom : 5,
				center : centerPos
			});

			// draw each greek, biblical, and event marker
			for (var i = 0; i < ancientEntities.length; i++) {
				var syear = "" + ancientEntities[i].StartYear;
				if (ancientEntities[i].StartYear < 0)
					syear = (-1 * (ancientEntities[i].StartYear)) + "BC";
				var eyear = "" + ancientEntities[i].EndYear;
				if (ancientEntities[i].EndYear < 0)
					eyear = (-1 * (ancientEntities[i].EndYear)) + "BC";
				var title = ancientEntities[i].LocationName + ': ' + ancientEntities[i].Subject
						+ ' (' + syear + '-' + eyear + ')';
				var pos = resolvePos(ancientEntities[i].Location);
	            var innerPinImage = new google.maps.MarkerImage(
	                    "http://chart.apis.google.com/chart?chst=d_map_xpin_letter&chld=pin_star|.|" + 
	                    		ancientEntities[i].Brightness + "|000000|" + ancientEntities[i].CategoryColor,
	                    new google.maps.Size(21, 34), new google.maps.Point(0, 0),
	                    new google.maps.Point(10, 34));
				var marker = new google.maps.Marker({
					title : title,
                    icon : innerPinImage,
					position : pos,
					map : map
				});
			}
		}
	</script>
	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCD_6gUgxcdBn7Egs-tepQWXpNz6ggAmQ8&callback=initMap">
		
	</script>
</body>
</html>